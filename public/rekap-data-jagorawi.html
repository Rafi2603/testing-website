<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rekap Data Jagorawi</title>
    <style>
        /* Basic Table Styles */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        table th, table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }

        table th {
            background-color: #0056b3;
            color: white;
        }

        table tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        table tr:hover {
            background-color: #ddd;
        }

        /* Modal Styling */
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.4);
        }

        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <!-- Dropdown to Filter by Year -->
    <label for="yearSelect">Filter by Year:</label>
    <select id="yearSelect" onchange="filterTableByYear()">
        <option value="">All Years</option>
    </select>

    <!-- Rekap Data Table -->
    <table id="data-table">
        <thead>
            <tr>
                <th>No</th>
                <th rowspan="2" onclick="sortTable(1)">Tahun</th>
                <th rowspan="2">Bulan</th>
                <th colspan="2">Jumlah Karyawan</th>
                <th colspan="2">Jumlah Hari Kerja</th>
                <th rowspan="2">Jumlah Jam Kerja</th>
                <th colspan="2">Kecelakaan Berat</th>
                <th colspan="2">Kecelakaan Ringan</th>
                <th colspan="2">Kecelakaan Meninggal</th>
                <th colspan="2">Near Miss</th>
                <th rowspan="2">Fire Accident</th>
                <th rowspan="2">Damaged Property</th>
                <th colspan="2">Jumlah Hari Hilang</th>
                <th colspan="2">Jumlah Hari Tanpa Hilang</th>
                <th colspan="2">LTI</th>
                <th colspan="2">Man Hour</th>
                <th rowspan="2">Frequency Rate (FR)</th>
                <th rowspan="2">Severity Rate (SR)</th>
                <th rowspan="2">Inchident Rate (SR)</th>
                <th rowspan="2">Average Time Lost Injury (ATLR)</th>
            </tr>
            <tr>
                <th>OPS</th>
                <th>Non-OPS</th>
                <th>OPS</th>
                <th>Non-OPS</th>
                <th>OPS</th>
                <th>Non-OPS</th>
                <th>OPS</th>
                <th>Non-OPS</th>
                <th>OPS</th>
                <th>Non-OPS</th>
                <th>OPS</th>
                <th>Non-OPS</th>
                <th>OPS</th>
                <th>Non-OPS</th>
                <th>OPS</th>
                <th>Non-OPS</th>
                <th>OPS</th>
                <th>Non-OPS</th>
                <th>OPS</th>
                <th>Non-OPS</th>
            </tr>
        </thead>
        <tbody>
            <!-- Table data will be dynamically inserted here -->
        </tbody>
    </table>

    <!-- Modal Trigger -->
    <button onclick="openModal()">Open Modal</button>

    <!-- Modal -->
    <div id="myModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <p>This is a modal!</p>
        </div>
    </div>

    <script>
        // Sample years to populate the dropdown
        const availableYears = [2024, 2025, 2026, 2027, 2028, 2029, 2030];
        const yearSelect = document.getElementById('yearSelect');
        availableYears.forEach(year => {
            const option = document.createElement('option');
            option.value = year;
            option.textContent = year;
            yearSelect.appendChild(option);
        });

        // Filter table by selected year
        function filterTableByYear() {
            const selectedYear = document.getElementById('yearSelect').value;
            const table = document.getElementById('data-table');
            const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
            
            for (let i = 0; i < rows.length; i++) {
                const yearCell = rows[i].getElementsByTagName('td')[1]; // Assuming year is in the 2nd column
                const year = yearCell.textContent || yearCell.innerText;
                
                if (selectedYear === "" || year === selectedYear) {
                    rows[i].style.display = "";
                } else {
                    rows[i].style.display = "none";
                }
            }
        }

        // Sort table by column (index)
        function sortTable(columnIndex) {
            const table = document.getElementById("data-table");
            const rows = Array.from(table.rows).slice(1); // Exclude header
            
            const sortedRows = rows.sort((a, b) => {
                const cellA = a.cells[columnIndex].innerText;
                const cellB = b.cells[columnIndex].innerText;
                
                // Sort logic: convert to numbers if necessary
                return isNaN(cellA) ? cellA.localeCompare(cellB) : cellA - cellB;
            });
            
            // Append sorted rows back to the table body
            const tbody = table.getElementsByTagName("tbody")[0];
            sortedRows.forEach(row => tbody.appendChild(row));
        }

        // Modal functions
        function openModal() {
            document.getElementById("myModal").style.display = "block";
        }

        function closeModal() {
            document.getElementById("myModal").style.display = "none";
        }

        // Fetch data for Rekap Data K3 JAGORAWI (example API request)
        fetch('https://your-api-url-here/getdatajagorawi')
            .then(response => response.json())
            .then(data => {
                if (data.message === 'Data Found') {
                    const tableBody = document.querySelector('#data-table tbody');
                    tableBody.innerHTML = ''; // Clear existing rows

                    data.showItems.forEach(item => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                        <td>${item.no || ''}</td>
                        <td>${item.tahun || ''}</td>
                        <td>${item.bulan || ''}</td>
                        <td>${item.jumlah_karyawan_ops || ''}</td>
                        <td>${item.jumlah_karyawan_non_ops || ''}</td>
                        <td>${item.jumlah_hari_kerja_ops || ''}</td>
                        <td>${item.jumlah_hari_kerja_non_ops || ''}</td>
                        <td>${item.jumlah_jam_kerja || ''}</td>
                        <td>${item.kecelakaan_berat_ops || ''}</td>
                        <td>${item.kecelakaan_berat_non_ops || ''}</td>
                        <td>${item.kecelakaan_ringan_ops || ''}</td>
                        <td>${item.kecelakaan_ringan_non_ops || ''}</td>
                        <td>${item.kecelakaan_meninggal_ops || ''}</td>
                        <td>${item.kecelakaan_meninggal_non_ops || ''}</td>
                        <td>${item.kecelakaan_near_miss_ops || ''}</td>
                        <td>${item.kecelakaan_near_miss_non_ops || ''}</td>
                        <td>${item.fire_accident || ''}</td>
                        <td>${item.damaged_property || ''}</td>
                        <td>${item.jumlah_hari_hilang_ops || ''}</td>
                        <td>${item.jumlah_hari_hilang_non_ops || ''}</td>
                        <td>${item.jumlah_hari_tanpa_hilang_ops || ''}</td>
                        <td>${item.jumlah_hari_tanpa_hilang_non_ops || ''}</td>
                        <td>${item.lti_ops || ''}</td>
                        <td>${item.lti_non_ops || ''}</td>
                        <td>${item.man_hour_ops || ''}</td>
                        <td>${item.man_hour_non_ops || ''}</td>
                        <td>${item.fr || ''}</td>
                        <td>${item.sr || ''}</td>
                        <td>${item.ir || ''}</td>
                        <td>${item.atlr || ''}</td>
                        `;
                        tableBody.appendChild(row);
                    });
                } else {
                    console.error('Data not found');
                }
            })
            .catch(error => console.error('Error fetching data:', error));
    </script>

</body>
</html>
